{
	"$schema": "http://json-schema.org/draft-04/schema#",
	"title": "SE meta specification",
	"type": "object",
	"properties": {
	
		"name": {
			"title": "The official name of the SE",
			"type": "string"
		},
		
		"owners": {
			"title": "The list of owners of the SE.",
			"type": "array",
			"items": {
				"type": "string"
			},
			"minItems": 1,
            "uniqueItems": true
		},
		
		"platforms": {
			"type": "array",
			"items": {
				"enum": ["socialtv", "smartcity", "gaming"]
			},
			"minItems": 1,
            "uniqueItems": true
		},
		
		"contacts": {
			"title": "The support contacts for this SE",
			"type": "object",
			"anyOf": [
				{
					"properties": {
						"primary": {
							"type": "string",
							"format": "^[A-Z]{3-5}\\-[A-Za-z]+$"
						}
					},
					"required": ["primary"]
				},
				
				{
					"patternProperties": {
						"^[A-Z]{3-5}\\-[A-Za-z]+$": {
							"enum": ["legal", "technical"]
						}
					}
				}
			]
		},
		
		"documentation": {
			"type": "object",
			
			"properties": {
				"what-it-does": {
					"type": "string",
					"maxLength": 600,
					"minLength": 200
				},
				"how-it-works": {
					"type": "string",
					"maxLength": 800,
					"minLength": 200
				},
				"why-you-need-it": {
					"type": "string",
					"maxLength": 600,
					"minLength": 150
				},
				"additional": {
					"type": "object",
					"additionalProperties": {
						"$ref": "#/defs/uri"
					}
				}
			},
			
			"additionalProperties": false,
			"required": ["what-it-does", "how-it-works", "why-you-need-it"]
		},
		
		"media": {
			"type": "object",
			
			"properties": {
			
				"videos": {
					"type": "object",
					"properties": {
						"pitch": {
							"anyOf": [
								{ "type": "null" },
								{ "$ref": "#/defs/uri" }
							]
						}
					},
					"patternProperties": {
						"^(?!pitch).+$": { "$ref": "#/defs/uri" }
					}
				},
				
				"images": {
					"type": "object",
					"additionalProperties": {
						"oneOf": [
							{ "$ref": "#/defs/wikimedia" },
							{ "$ref": "#/defs/uri" }
						]
					}
				}
				
			},
			
			"additionalProperties": false
		},
		
		"examples": {
			"type": "object",
			"properties": {
				"live-demo": {
					"type": "object",
					"allOf": [
						{ "$ref": "#/defs/DescribedReference" },
						{
							"type": "object",
							"properties": {
								"link": { "$ref": "#/defs/uri" }
							}
						}
					],
					"required": ["title", "description", "link"],
					"additionalProperties": false

				},
				"playground": {
					"allOf": [
						{ "$ref": "#/defs/DescribedReference" },
						{
							"type": "object",
							"properties": {
								"link": {
									"type": "string"
								}
							}
						}
					],
					"required": ["title", "description", "link"],
					"additionalProperties": false
				}
			},
			"additionalProperties": {
				"$ref": "#/defs/LinkedReference"

			}
		},
		
		"license": {
			"type": "object",
			"properties": {
				"template": {
					"type": "string",
					"enum": ["MIT", "Apache2.0", "LGPL"]
				},
				"type": {
					"enum": ["open", "prop", "eval"]
				},
				"features": {
					"type": "object",
					"properties": {
						"commercial-use": { "$ref": "#/defs/YesNo" },
						"modifications-allowed": { "$ref": "#/defs/YesNo" },
						"distribution-allowed": { "$ref": "#/defs/YesNo" },
						"include-copyright": { "$ref": "#/defs/Required" },
						"include-original": { "$ref": "#/defs/Required" },
						"state-changes": { "$ref": "#/defs/Required" },
						"disclose": { "$ref": "#/defs/Required" }
					},
					"additionalProperties": false,
					"required": ["commercial-use", "modifications-allowed", "distribution-allowed", "include-copyright", "include-original", "state-changes", "disclose"]
				},
				"fee": {
					"type": "string"
				},
				"summary": {
					"type": "string",
					"minLength": 50,
					"maxLength": 600
				},
				"copyright": {
					"type": "string",
					"maxLength": 300
				},
				"full": {
					"type": "string"
				}
			},
			"additionalProperties": false,
			"anyOf": [
				{ "required": ["template"] },
				{ "required": ["type", "features", "fee", "summary", "copyright", "full"] }
			]
		},
		
		"delivery": {
			"type": "object",
			"properties": {
			
				"description": {
					"type": "string",
					"minLength": 50,
					"maxLength": 300
				},
				
				"languages": {
					"type": "array",
					"uniqueItems": true,
					"minItems": 1,
					"items": {
						"type": "string",
						"enum": ["JavaScript", "UnityScript", "C#", "PHP", "Python", "CSS", "C/C++", "Java", "Scala", "Go", "JSON"]
					}
				},
			
				"repository": {
					"type": "object",
					"properties": {
						"github": { "$ref": "#/defs/uri" },
						"git": { "$ref": "#/defs/uri" },
						"svn": { "$ref": "#/defs/uri" },
						"hg": { "$ref": "#/defs/uri" }
					},
					"additionalProperties": false,
					"oneOf": [
						{ "required": ["github"] },
						{ "required": ["git"] },
						{ "required": ["svn"] },
						{ "required": ["hg"] }
					]
				},
				
				"sources": { "$ref": "#/defs/uri" },
				
				"binary": {
					"type": "object",
					"properties": {
						"win": { "$ref": "#/defs/uri" },
						"unix": { "$ref": "#/defs/uri" },
						"osx": { "$ref": "#/defs/uri" }
					},
					"additionalProperties": { "$ref": "#/defs/uri" }
				},
				
				"instances": {
					"type": "object",
					"properties": {
						"public": { "$ref": "#/defs/instance" },
						"fi-ppp": { "$ref": "#/defs/instance" }
					},
					"additionalProperties": false,
					"anyOf": [
						{ "required": ["public"] },
						{ "required": ["fi-ppp"] }
					]
				},

				"manually": {
					"type": "string",
					"minLength": 10
				}
			
			},
			"additionalProperties": false,
			"anyOf": [
				{ "required": ["description", "repository"] },
				{ "required": ["description", "sources"] },
				{ "required": ["description", "binary"] },
				{ "required": ["description", "instances"] },
				{ "required": ["description", "manually"] }
			]
		},
		
		"requirements": {
			"type": "object",
			"additionalProperties": {
				"type": "object",
				"properties": {
					"title": {
						"type": "string",
						"maxLength": 45
					},
					"description": {
						"type": "string",
						"minLength": 25,
						"maxLength": 200
					},
					"link": {
						"oneOf": [
							{ "$ref": "#/defs/wikimedia" },
							{ "$ref": "#/defs/uri" },
							{ "$ref": "#/defs/null" }
						]
					}
				},
				"required": ["title", "description"],
				"additionalProperties": false
			}
		}
		
	},
	"additionalProperties": false,
	"required": ["name", "owners", "platforms", "contacts", "license", "delivery"],
	
	"defs": {
	
		"YesNo": {
			"enum": ["Yes", "No"]
		},
		
		"Required": {
			"enum": ["Required", "Not required", "Not applicable"]
		},
		
		"uri": {
			"type": "string",
			"format": "uri",
			"pattern": "^https?://(.+)/(.+)?$"
		},
		
		"wikimedia": {
			"type": "string",
			"pattern": "^(:[a-zA-Z0-9_\\-\\.]+)+\\.(png|jpg|gif)$"
		},
		
		"null": {
			"type": "null"
		},
		
		"DescribedReference": {
			"type": "object",
			"properties": {
				"title": {
					"type": "string",
					"maxLength": 45
				},
				"description": {
					"type": "string",
					"minLength": 60,
					"maxLength": 250
				}
			}
		},
		
		"LinkedReference": {
			"type": "object",
			"allOf": [
				{ "$ref": "#/defs/DescribedReference" },
				{
					"type": "object",
					"properties": {
						"link": {
							"oneOf": [
								{ "$ref": "#/defs/wikimedia" },
								{ "$ref": "#/defs/uri" }
							]
						}
					}
				}
			],
			"required": ["title", "description", "link"],
			"additionalProperties": false
		},
		
		"instance": {
			"type": "object",
			"properties": {
				"endpoint": { "$ref": "#/defs/uri" },
				"access": {
					"oneOf": [
						{ "$ref": "#/defs/credentials" },
						{ "$ref": "#/defs/instructions" }
					]
				}
			},
			"additionalProperties": false			
		},
		
		"credentials": {
			"type": "object",
			"properties": {
				"user": {
					"type": "string",
					"maxLength": 30
				},
				"password": {
					"type": "string",
					"maxLength": 30
				}
			},
			"required": ["user", "password"],
			"additionalProperties": false
		},
		"instructions": {
			"type": "object",
			"properties": {
				"manually": {
					"type": "string",
					"maxLength": 100
				}
			},
			"required": ["manually"],
			"additionalProperties": false
		}
						
	}
}
